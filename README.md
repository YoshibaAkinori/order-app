# 松栄寿し注文管理システム

年末年始などの繁忙期に特化した、Webベースの注文管理アプリケーションです。従来のExcelを使った電話・FAXによる注文管理をデジタル化し、複数人でのリアルタイムな情報共有、ミスの削減、業務の大幅な効率化を実現します。

## 目次

- [主な機能](#主な機能)
- [⚠️ 注意事項](#注意事項)
- [アプリケーションの使い方](#アプリケーションの使い方)
  - [1. ログイン](#1-ログイン)
  - [2. 年度の選択](#2-年度の選択)
  - [3. 新規注文](#3-新規注文)
    - [ステップ1：発注者様の情報を入力する](#ステップ1発注者様の情報を入力する)
    - [ステップ2：注文内容を登録する](#ステップ2注文内容を登録する)
    - [ステップ3：お支払い情報を設定する](#ステップ3お支払い情報を設定する)
    - [ステップ4：注文確認書を開き、送信](#ステップ4注文確認書を開き送信)
  - [4. 注文変更](#4-注文変更)
    - [変更方法](#変更方法)
    - [キャンセルを行いたい場合](#キャンセルを行いたい場合)
  - [5. 注文一覧](#5-注文一覧)
    - [一覧ページで出来ること](#一覧ページで出来ること)
  - [6. 割振管理](#6-割振管理)
  - [7. 集計・管理機能](#7-集計管理機能)
    - [ネタ数集計](#ネタ数集計)
    - [ネタ変更管理](#ネタ変更管理)
  - [8. 設定管理](#8-設定管理)
    - [カード詳細](#カード詳細)
  - [9. 変更ログ](#9-変更ログ)
  - [10. メール](#10-メール)
- [注文番号の見方](#注文番号の見方)
  - [注文番号の構造](#注文番号)
  - [受付番号（中央3桁）の詳細](#受付番号-中央の3桁)
- [こんな時はどうするの？ (FAQ)](#こんな時はどうするの-faq)
- [🔧 使用技術](#使用技術)

---

## ✨ 主な機能

| 機能 | 概要 |
| :--- | :--- |
| **年度ごとのデータ管理** | 注文データや設定を年ごとに完全に分離し、安全に管理。 |
| **リアルタイム注文管理** | 新規注文、注文内容の変更をWebフォームから直感的に入力。 |
| **自動番号採番** | 受付番号・注文番号をルールに基づき注文時に自動で生成。 |
| **注文一覧** | 特定の日付や担当者ごとの注文状況を一覧で確認。 |
| **PDF注文確認書** | ワンクリックで注文確認書を生成・印刷。(FAX送信用) |
| **割振管理** | 配達ルートごとの注文を可視化し、担当者を割り当て。 |
| **自動集計機能** | ネタ数や商品ごとの注文件数をリアルタイムで自動集計。 |
| **マスターデータ管理** | 商品メニュー、ネタの種類、配達先などのマスターデータをWeb上から簡単に編集。 |
| **メール通知** | 注文確定時にお客様へ自動で確認メールを送信。最終確認メールも一覧から送信。|

---

## ⚠️ 注意事項

#### メール通知に関する注意
**メールが記載されているものにはメール送信のチェックを外さない限りメールが送信されます。**
意図しない通知を防ぐため、以下にご注意ください。
- 注文内容に関わらない重要度の低い変更はチェックを外すこと
- 注文内容（住所の統一など）の微調整は、一度Excelに出力してから行うことを推奨します。
![チェックボックス](/public/photo/checkBox.png)

#### 設定変更に関する注意
**注文を入力し始めてから設定を変更するのは危険です。（※データの追加は問題ありません）**
意図しない不具合を防ぐため、以下にご注意ください。
- 運用開始後の不用意な設定変更は避けてください。
- 特に、割り当てアルファベットの内容を変更すると、注文番号の整合性が取れなくなる可能性があります。

---

## アプリケーションの使い方

### 1. ログイン
アプリにアクセスすると、ログイン画面が表示されます。
![ログイン画面](/public/photo/Login.png)

### 2. 年度の選択
ログイン後、サイドバーの「年度選択」から操作したい年を選びます。ここで選択した年に基づいて、全てのデータが読み込まれます。
![年度選択画面](/public/photo/YearSelect.png)

### 3. 新規注文
サイドバーの「新規注文」から、新しい注文を入力します。
新規注文は、大きく分けて以下の4ステップで完了します。

**① 発注者情報の入力 → ② 注文内容の登録 → ③ お支払い情報の設定 → ④ 注文確認書での確認・送信**

---

#### **ステップ1：発注者様の情報を入力する**

まず、どなたからの注文かを明確にするため、発注者様の情報を入力します。

- **担当者名、連絡先など**: 画面の指示に従って、各項目を入力してください。
- **住所、階数**:
    - 登録済みの住所リストから配達先を選択します。
    - 配達先に階数がある場合は入力してください。**階数がない、または不要な場合は空欄のままで問題ありません。**

![新規注文Form](/public//photo/Order_customer.png)
---

#### **ステップ2：注文内容を登録する**

次に、ご注文の商品と数量を登録します。

1.  **商品の数量をまとめて入力**
    - まず、 **ネタ変更やサビ抜きなども含めた、その商品の合計個数** を先に入力します。  
    （例：極を合計5個注文し、そのうち1個がサビ抜きの場合でも、まず「5」と入力します）
    ![新規注文Form](/public//photo/Order_product.png)

2.  **ネタ変更やサビ抜きなどを設定**
    - 数量を入力後、 **「ネタ変更・その他の注文」** ボタンが表示されます。これをクリックすると詳細設定画面が開き、特定の個数だけ「サビ抜き」にしたり、「折」に詰めたり、ネタを変更したりといった細かい指定が可能です。

3.  **お吸い物などの特別注文**
    - お寿司以外のサイドメニュー（お吸い物、お醤油など）は、　**「その他のご注文」**　の項目から追加してください。
    ![新規注文Form](/public//photo/Order_else.png)
---

#### **ステップ3：お支払い情報を設定する**

次に、お支払いの方法や領収書について設定します。

- **基本的な領収書の発行**
  - **「支払い方法」** と **「領収書の宛名」** を入力するだけで、注文全体の合計金額の領収書が自動で作成されます。

- **支払いをまとめたい場合（合算支払い）**
  1. **「まとめてお支払いの有無」** ボタンをクリックします。
  2. 「支払日を追加」ボタンを押し、**「どの注文の配達日に支払うか」** を選択します。
  3. その日にまとめて支払いたい注文すべてにチェックを入れると、チェックした注文の合計金額で領収書が設定されます。

- **領収書を分けたい・金額を指定したい場合**
  1. **「領収書・請求書の詳細指定」** ボタンをクリックします。
  2. 「領収書/請求書を追加」ボタンを押し、必要な枚数だけ入力フォームを追加します。
  3. それぞれのフォームで **「発行日」「宛名」「金額」** を自由に設定できます。
  ![新規注文Form](/public//photo/Order_pay.png)

---

#### **ステップ4：注文確認書を開き、送信**

最後に、注文確認書を開き、入力された情報と手元の注文用紙とで内容に違いがないかを確認してください。

  - もし、ミスがあれば **「修正」** ボタンから入力画面に戻って変更してください。
  - 問題がなければ **「送信」** ボタンを押して注文を登録します。
  - 注文が登録される際、メールアドレスが入力されていれば、お客様へ同時に確認メールも送信されます。
  - メールアドレスが入力されておらずFAX番号のみある場合は、 **「印刷」** ボタンから印刷し、FAXを送信してください。
  ![新規注文Form](/public//photo/Order_model.png)

---

### 4. 注文変更

#### 変更方法
- **方法1：「注文変更」ページから** 

「注文変更」ページで受付番号を入力して検索すると、既存の注文を編集できます。
  ![注文変更画面1](/photo/Change1.png)

- **方法2：「注文一覧」ページから** 

「注文一覧」ページで注文番号をクリックすると、その注文を直接編集できます。
  ![注文変更画面2](/public//photo/Change2.png)

  どちらの方法でも、検索後に表示される画面で変更したい箇所を修正し、**「この内容で更新を確認」** ボタンを押すと変更が反映されます。

#### キャンセルを行いたい場合
- **個別の注文をキャンセル** 

各注文の右上にある`×`ボタンをクリックすると、その注文が「キャンセル予定」状態になります。
  ![注文キャンセル1](/public//photo/Cancel1.png)

- **受付全体をキャンセル** 

最後の1件の注文をキャンセルする場合や、受付全体を取り消す場合は、ページ最下部の **「この受付を全てキャンセル」** ボタンを押してください。
  ![注文キャンセル2](/public//photo/Cancel2.png)

---

### 5. 注文一覧
「注文一覧」では、日付や担当者で注文を絞り込み、一覧で確認できます。

- **PDF出力**: 各注文の右側にあるPDFボタンを押すと、印刷可能な注文確認書が新しいタブで開きます。
- **メールアドレス警告**: お客様情報にメールアドレスが登録されていない注文は、PDFボタンが赤枠で表示され、注意を促します。
![注文一覧](/public//photo/Dashboard.png)

#### 一覧ページで出来ること
「注文一覧」では、主に以下の3つの操作が可能です。

1.  **一覧Excelの出力** 表示されている注文の中から、必要な配達ルート（担当者）を選択して、一覧形式のExcelファイルを出力できます。
    ![一覧エクセル](/public//photo/Dashboard_excel.png)

2.  **領収書Excelの出力** 指定した日付の領収書（代金引換用）の宛名リストをExcel形式で出力できます。
    ![領収書excel](/public//photo/Dashboard_atena.png)

3.  **最終確認メールの一括送信** メールアイコンをクリックすると、表示されている注文リストの中で、メールアドレスが登録されているお客様全員に最終確認メールを一括で送信できます。

> **Note** > 一覧Excelや領収書Excelの出力は、**「割振管理」** で配達担当者が割り当てられている注文のみが対象となります。

---

### 6. 割振管理
「割振管理」ページでは、特定の日付の注文を配達先（建物・階層）ごとにグループ化して表示します。各注文グループまたは個別の注文に配達担当者を割り当て、**「割振決定 更新」** ボタンで保存します。
![割振管理](/public//photo/Allocation.png)

---

### 7. 集計・管理機能

#### ネタ数集計
指定した日付と担当者グループ（東口、日詰など）で、その日に必要なネタの総数を商品別・ネタ別にリアルタイムで自動集計します。右側のネタ数部分をクリックすると、より詳細な内訳を確認できます。
![ネタ数集計](/public//photo/CountNeta.png)

#### ネタ変更管理
ネタの変更（抜き・追加）が行われた注文だけを一覧で確認し、変更内容を管理する専用画面です。
![ネタ変更](/public//photo/ChangeNeta.png)

---

### 8. 設定管理
「設定管理」ページでは、システムの動作に必要な各種マスターデータを編集します。

- **年度更新**: 設定が存在しない新しい年を選択すると、前年の設定をコピーして年度更新を行うためのボタンが表示されます。
  ![設定管理](/public//photo/Setting1.png)

- **詳細設定**: 各カードをクリックすると、それぞれの詳細設定画面が開きます。
  ![設定管理](/public//photo/Setting2.png)

#### カード詳細
- **配達日管理**: 注文を受け付ける日付を管理します。  
  ![設定カード](/public//photo/Set_date.png)
- **配達時間管理**: 配達時間の選択肢を管理します。  
  ![設定カード](/public//photo/Set_time.png)
- **通常メニュー管理**: 通常メニューの商品内容や価格、構成ネタを管理します。  
  ![設定カード](/public//photo/Set_product.png)
- **特殊メニュー管理**: お吸い物など、その他の注文や特別メニューを管理します。  
  ![設定カード](/public//photo/Set_side.png)
- **割り振り管理**: 配達担当の名称（例: 県庁担当、市役所担当）を管理します。  
  ![設定カード](/public//photo/Set_warihuri.png)
- **割り当て管理**: 「東口」「日詰」といったグループが、どの「割り振り（配達担当）」を担当するかを管理します。  
  ![設定カード](/public//photo/Set_wariate.png)
- **割当て番号管理**: 注文番号の自動採番に使われる記号と住所の対応を管理します。  
  ![設定カード](/public//photo/Set_route.png)
- **ネタ種類管理**: 商品に使用されるすべてのネタの種類とカテゴリを管理します。  
  ![設定カード](/public//photo/Set_neta.png)

---

### 9. 変更ログ
「注文変更」ページで行われた変更は、変更内容と日時が自動で記録されます。
![変更ログ](/public//photo/ChangeLog.png)

> **Note** > 変更内容がない場合でも「更新」ボタンを押すと履歴が記録されてしまうため、ご注意ください。

---

### 10. メール
ヘッダー（画面上部）のメールアイコンをクリックすると、お客様とのメールのやり取りを確認・返信できる専用の受信トレイが開きます。
![メール](/public//photo/Mail.png)

---

## 注文番号の見方

### 注文番号
「いつ」「どこから」「何番目」の注文かが一目でわかるように作られた、6桁の番号です。

`[日付 (2桁)]` + `[受付番号 (3桁)]` + `[通し番号 (1桁)]`

### 受付番号 (中央の3桁)
注文元の場所（建物・階数・部署）を特定するための番号です。

`[建物の記号 (1文字目)]` + `[階数 (2文字目)]` + `[部署の記号 (3文字目)]`

- **建物の記号**: どの建物・部署グループからの注文かを示します。（例：`A` → 県庁）
  - ※各記号がどの場所に対応するかは、設定画面の「割り当て番号管理」で確認・編集できます。
- **階数**: その部署がある建物の階数がそのまま入ります。（例：`7` → 7階）
- **部署の記号**: 同じ階にある複数の部署を区別するための記号です。（例：`A`）

---

**注文番号の例： `27A7A1`**

- `27` → 12月 **27** 日の注文
- `A7A` → **県庁7階のA部署** からの注文
- `1` → その場所（A7A）での、その日 **1番目** の注文

---

## こんな時はどうするの？ (FAQ)

<details>
  <summary><strong>1. 追加したい特別注文がない時</strong></summary>
  <br>

  1. 「設定管理」ページから、「特殊メニュー管理」を選択します。
  2. 「追加」ボタンを押し、新しい商品の詳細（名前・金額・構成ネタなど）を入力して保存します。
</details>

<details>
  <summary><strong>2. 別の日にちの注文を追加したい</strong></summary>
  <br>

  1. 「設定管理」ページから、「配達日管理」を選択します。
  2.  新しい配達日を入力し、「追加」ボタンを押します。
</details>

<details>
  <summary><strong>3. お客様に個別にメールを送信したい</strong></summary>
  <br>
  
  > **Note** > この機能は、お客様への返信や、最終確認メールの再送を目的としています。全く新しい内容のメールを送信することはできません。

  1. ヘッダーのメールアイコンから受信トレイを開きます。
  2. 「送信済み」または「最終確認」の一覧から、送りたい相手のスレッドを選択します。
  3. 入力欄にメッセージを追記し、「送信」ボタンを押してください。
</details>

<details>
  <summary><strong>4. 使いたいネタが見つからない（新しいネタの登録方法）</strong></summary>
  <br>
  新しい商品を登録する際に、使いたいネタが選択肢にない場合は、以下の手順で追加できます。

  1. 「設定管理」ページから、「ネタ種類管理」を選択します。
  2. 「新しいネタを追加」ボタンを押し、ネタの名前とカテゴリを入力して保存します。
  3. カテゴリは、ネタ数集計の際にグループ化するために使用します。（例：シャリ玉、海苔巻き玉 など）
</details>

---

## 🔧 使用技術

- **フロントエンド**: Next.js (React), Tailwind CSS
- **バックエンド**: AWS Lambda (Node.js, Python)
- **データベース**: AWS DynamoDB
- **認証**: AWS Cognito
- **メール送信**: AWS SES
- **ホスティング**: Vercel (フロントエンド), AWS (バックエンド)
- **ワークフロー**:![ワークフロー](/public//photo/flow.png)